!!!
/
  Nested tabs controls against HTML markup, using {{wrap}}
%html{:xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %title Nested tabs controls against HTML markup, using {{wrap}}
    %link{:href => "resources/tabs.css", :rel => "stylesheet", :type => "text/css"}/
  %body
    %h1 Tabs
    #tabsView ..loading
    %script{:src => "http://code.jquery.com/jquery.js"}
    %script{:src => "../../../jquery.tmpl.js", :type => "text/javascript"}
    %script#tabsTmpl{:type => "text/x-jquery-tmpl"}
      {{wrap(null, {state: outerState}) "#tabsWrap"}}
      %h3 Inline
      %div
        Rendering a
        %span.special template
        declared in script block
      %h3 String
      %div
        Rendering a
        %span.special template
        passed as a string
      %h3 Remote
      %div
        Rendering remote data using
        %span.special templates
        {{wrap(null, {state: innerState}) "#tabsWrap"}}
        %h3 GET
        %div
          Using
          %b GET
          to fetch data
        %h3 POST
        %div
          Using
          %b POST
          to update server data
        {{/wrap}}
      {{/wrap}}
    %script#tabsWrap{:type => "text/x-jquery-tmpl"}
      %table.tabsView
        %tbody
          %tr
            {{each tabs()}}
            %th{:class => "${headerClass($index)}"}
              ${$value}
            {{/each}}
          %tr
            %td{:colspan => "${tabCount()}"}
              .body
                {{html tabContent()}}
    :javascript
      var innerState = { activeIndex: 0 },
      	outerState = { activeIndex: 2 };

      // ******************** Load UI ********************

      function refresh() {
      	$( "#tabsView" ).empty();
      	$( "#tabsTmpl" ).tmpl().appendTo( "#tabsView" );
      }
      refresh();


      // ******************** Events ********************

      $( "#tabsView" )
      	.delegate( ".header_false", "click", function() {
      		var ti = $.tmplItem( this );
      		ti.state.activeIndex = $(this).index();
      		refresh();
      	});

      // ******************** Helper functions ********************

      function tabs() {
      	return this.html("h3", true);
      }

      function tabCount() {
      	return this.html("h3").length;
      }

      function headerClass( index ) {
      	return index === this.state.activeIndex ? "header_true" : "header_false";
      }

      function tabContent() {
      	return this.html("div")[this.state.activeIndex];
      }

