/*
 New BSD License <http://creativecommons.org/licenses/BSD/>
*/
(function(f){var i=f.document,j=f.setInterval||j,a=f.History=f.History||{};if(typeof a.initHtml4!=="undefined")throw Error("History.js HTML4 Support has already been loaded...");a.initHtml4=function(){if(typeof a.initHtml4.initialized!=="undefined")return false;else a.initHtml4.initialized=true;a.enabled=true;a.savedHashes=[];a.isLastHash=function(b){var c=a.getHashByIndex();return b===c};a.saveHash=function(b){if(a.isLastHash(b))return false;a.savedHashes.push(b);return true};a.getHashByIndex=function(b){var c=
null;return c=typeof b==="undefined"?a.savedHashes[a.savedHashes.length-1]:b<0?a.savedHashes[a.savedHashes.length+b]:a.savedHashes[b]};a.discardedHashes={};a.discardedStates={};a.discardState=function(b,c,e){var g=a.getHashByState(b);a.discardedStates[g]={discardedState:b,backState:e,forwardState:c};return true};a.discardHash=function(b,c,e){a.discardedHashes[b]={discardedHash:b,backState:e,forwardState:c};return true};a.discardedState=function(b){b=a.getHashByState(b);return a.discardedStates[b]||
false};a.discardedHash=function(b){return a.discardedHashes[b]||false};a.recycleState=function(b){var c=a.getHashByState(b);a.discardedState(b)&&delete a.discardedStates[c];return true};if(a.emulated.hashChange)a.hashChangeInit=function(){a.checkerFunction=null;var b="",c,e,g;a.isInternetExplorer()?(c=i.createElement("iframe"),c.setAttribute("id","historyjs-iframe"),c.style.display="none",i.body.appendChild(c),c.contentWindow.document.open(),c.contentWindow.document.close(),e="",g=false,a.checkerFunction=
function(){if(g)return false;g=true;var d=a.getHash()||"",h=a.unescapeHash(c.contentWindow.document.location.hash)||"";if(d!==b){b=d;if(h!==d)e=d,c.contentWindow.document.open(),c.contentWindow.document.close(),c.contentWindow.document.location.hash=a.escapeHash(d);a.Adapter.trigger(f,"hashchange")}else h!==e&&(e=h,a.setHash(h,false));g=false;return true}):a.checkerFunction=function(){var c=a.getHash();c!==b&&(b=c,a.Adapter.trigger(f,"hashchange"));return true};a.intervalList.push(j(a.checkerFunction,
a.options.hashChangeInterval));return true},a.Adapter.onDomLoad(a.hashChangeInit);if(a.emulated.pushState)a.onHashChange=function(b){var c=a.getHashByUrl(b&&b.newURL||i.location.href),b=null;if(a.isLastHash(c))return a.busy(false),false;a.doubleCheckComplete();a.saveHash(c);if(c&&a.isTraditionalAnchor(c))return a.Adapter.trigger(f,"anchorchange"),a.busy(false),false;b=a.extractState(a.getFullUrl(c||i.location.href,false),true);if(a.isLastSavedState(b))return a.busy(false),false;a.getHashByState(b);
if(c=a.discardedState(b))return a.getHashByIndex(-2)===a.getHashByState(c.forwardState)?a.back(false):a.forward(false),false;a.pushState(b.data,b.title,b.url,false);return true},a.Adapter.bind(f,"hashchange",a.onHashChange),a.pushState=function(b,c,e,g){if(a.getHashByUrl(e))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(g!==false&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:g}),false;a.busy(true);var d=a.createStateObject(b,
c,e),h=a.getHashByState(d),k=a.getState(false),k=a.getHashByState(k),j=a.getHash();a.storeState(d);a.expectedStateId=d.id;a.recycleState(d);a.setTitle(d);if(h===k)return a.busy(false),false;if(h!==j&&h!==a.getShortUrl(i.location.href))return a.setHash(h,false),false;a.saveState(d);a.Adapter.trigger(f,"statechange");a.busy(false);return true},a.replaceState=function(b,c,e,g){if(a.getHashByUrl(e))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(g!==false&&
a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:g}),false;a.busy(true);var d=a.createStateObject(b,c,e),h=a.getState(false),f=a.getStateByIndex(-2);a.discardState(h,d,f);a.pushState(d.data,d.title,d.url,false);return true};if(a.emulated.pushState&&a.getHash()&&!a.emulated.hashChange)a.Adapter.onDomLoad(function(){a.Adapter.trigger(f,"hashchange")})};typeof a.init!=="undefined"&&a.init()})(window);
