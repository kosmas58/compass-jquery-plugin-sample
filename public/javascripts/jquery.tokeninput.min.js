(function(b){var A,x,B={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,resultsFormatter:function(b){return"<li>"+b[this.propertyToSearch]+"</li>"},tokenFormatter:function(b){return"<li><p>"+b[this.propertyToSearch]+"</p></li>"},tokenLimit:null,tokenDelimiter:",",
preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-"},C={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"};
A=0;x=1;var t={init:function(h,j){var a=b.extend({},B,j||{});return this.each(function(){b(this).data("tokenInputObject",new b.TokenList(this,h,a))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(b){this.data("tokenInputObject").add(b);return this},remove:function(b){this.data("tokenInputObject").remove(b);return this},get:function(){return this.data("tokenInputObject").getTokens()}};b.fn.tokenInput=function(b){return t[b]?t[b].apply(this,Array.prototype.slice.call(arguments,
1)):t.init.apply(this,arguments)};b.TokenList=function(h,j,a){function r(){null!==a.tokenLimit&&k>=a.tokenLimit&&(g.hide(),o())}function J(e){var c=a.tokenFormatter(e),c=b(c).addClass(a.classes.token).insertBefore(p);b("<span>"+a.deleteText+"</span>").addClass(a.classes.tokenDelete).appendTo(c).click(function(){y(b(this).parent());i.change();return!1});b.data(c.get(0),"tokeninput",e);l=l.slice(0,m).concat([e]).concat(l.slice(m));m++;t(l,i);k+=1;null!==a.tokenLimit&&k>=a.tokenLimit&&(g.hide(),o());
return c}function D(e){var c=a.onAdd;if(0<k&&a.preventDuplicates){var d=null;q.children().each(function(){var a=b(this),c=b.data(a.get(0),"tokeninput");if(c&&c.id===e.id)return d=a,!1});if(d){w(d);p.insertAfter(d);g.focus();return}}if(null==a.tokenLimit||k<a.tokenLimit)J(e),r();g.val("");o();b.isFunction(c)&&c.call(i,e)}function w(b){b.addClass(a.classes.selectedToken);f=b.get(0);g.val("");o()}function u(b,c){b.removeClass(a.classes.selectedToken);f=null;c===A?(p.insertBefore(b),m--):c===x?(p.insertAfter(b),
m++):(p.appendTo(q),m=k);g.focus()}function y(e){var c=b.data(e.get(0),"tokeninput"),d=a.onDelete,v=e.prevAll().length;v>m&&v--;e.remove();f=null;g.focus();l=l.slice(0,v).concat(l.slice(v+1));v<m&&m--;t(l,i);k-=1;null!==a.tokenLimit&&g.show().val("").focus();b.isFunction(d)&&d.call(i,c)}function t(e,c){var d=b.map(e,function(b){return"function"==typeof a.tokenValue?a.tokenValue.call(this,b):b[a.tokenValue]});c.val(d.join(a.tokenDelimiter))}function o(){s.hide().empty();n=null}function z(){s.css({position:"absolute",
top:b(q).offset().top+b(q).outerHeight(),left:b(q).offset().left,"z-index":999}).show()}function E(e,c){if(c&&c.length){s.empty();var d=b("<ul>").appendTo(s).mouseover(function(a){F(b(a.target).closest("li"))}).mousedown(function(a){D(b(a.target).closest("li").data("tokeninput"));i.change();return!1}).hide();b.each(c,function(c,g){var f=a.resultsFormatter(g),f=f.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+g[a.propertyToSearch]+")(?![^<>]*>)(?![^&;]+;)","g"),g[a.propertyToSearch].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+
e+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")),f=b(f).appendTo(d);c%2?f.addClass(a.classes.dropdownItem):f.addClass(a.classes.dropdownItem2);0===c&&F(f);b.data(f.get(0),"tokeninput",g)});z();a.animateDropdown?d.slideDown("fast"):d.show()}else a.noResultsText&&(s.html("<p>"+a.noResultsText+"</p>"),z())}function F(e){e&&(n&&(b(n).removeClass(a.classes.selectedDropdownItem),n=null),e.addClass(a.classes.selectedDropdownItem),n=e.get(0))}function K(){var e=g.val().toLowerCase();e&&e.length&&(f&&u(b(f),
x),e.length>=a.minChars?(a.searchingText&&(s.html("<p>"+a.searchingText+"</p>"),z()),clearTimeout(L),L=setTimeout(function(){B(e)},a.searchDelay)):o())}function B(e){var c=e+G(),d=H.get(c);if(d)E(e,d);else if(a.url){var d=G(),f={data:{}};-1<d.indexOf("?")?(d=d.split("?"),f.url=d[0],d=d[1].split("&"),b.each(d,function(a,b){var e=b.split("=");f.data[e[0]]=e[1]})):f.url=d;f.data[a.queryParam]=e;f.type=a.method;f.dataType=a.contentType;if(a.crossDomain)f.dataType="jsonp";f.success=function(d){b.isFunction(a.onResult)&&
(d=a.onResult.call(i,d));H.add(c,a.jsonContainer?d[a.jsonContainer]:d);g.val().toLowerCase()===e&&E(e,a.jsonContainer?d[a.jsonContainer]:d)};b.ajax(f)}else a.local_data&&(d=b.grep(a.local_data,function(b){return-1<b[a.propertyToSearch].toLowerCase().indexOf(e.toLowerCase())}),b.isFunction(a.onResult)&&(d=a.onResult.call(i,d)),H.add(c,d),E(e,d))}function G(){var b=a.url;"function"==typeof a.url&&(b=a.url.call());return b}if("string"===b.type(j)||"function"===b.type(j)){if(a.url=j,j=G(),void 0===a.crossDomain)a.crossDomain=
-1===j.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==j.split(/\/+/g)[1]}else if("object"===typeof j)a.local_data=j;a.classes?a.classes=b.extend({},C,a.classes):a.theme?(a.classes={},b.each(C,function(b,c){a.classes[b]=c+"-"+a.theme})):a.classes=C;var l=[],k=0,H=new b.TokenList.Cache,L,I,g=b('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",a.idPrefix+h.id).focus(function(){if((null===a.tokenLimit||a.tokenLimit!==k)&&a.hintText)s.html("<p>"+a.hintText+"</p>"),z()}).blur(function(){o();
b(this).val("")}).bind("keyup keydown blur update",function(){if(I!==(I=g.val())){var b=I.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");M.html(b);g.width(M.width()+30)}}).keydown(function(a){var c,d;switch(a.keyCode){case 37:case 39:case 38:case 40:if(b(this).val())return c=null,c=40===a.keyCode||39===a.keyCode?b(n).next():b(n).prev(),c.length&&F(c),!1;c=p.prev();d=p.next();c.length&&c.get(0)===f||d.length&&d.get(0)===f?37===a.keyCode||38===a.keyCode?u(b(f),A):
u(b(f),x):(37===a.keyCode||38===a.keyCode)&&c.length?w(b(c.get(0))):(39===a.keyCode||40===a.keyCode)&&d.length&&w(b(d.get(0)));break;case 8:c=p.prev();if(b(this).val().length)1===b(this).val().length?o():setTimeout(function(){K()},5);else return f?(y(b(f)),i.change()):c.length&&w(b(c.get(0))),!1;break;case 9:case 13:case 108:case 188:if(n)return D(b(n).data("tokeninput")),i.change(),!1;break;case 27:return o(),!0;default:String.fromCharCode(a.which)&&setTimeout(function(){K()},5)}}),i=b(h).hide().val("").focus(function(){g.focus()}).blur(function(){g.blur()}),
f=null,m=0,n=null,q=b("<ul />").addClass(a.classes.tokenList).click(function(a){if((a=b(a.target).closest("li"))&&a.get(0)&&b.data(a.get(0),"tokeninput")){var c=f;f&&u(b(f),2);c===a.get(0)?u(a,2):w(a)}else f&&u(b(f),2),g.focus()}).mouseover(function(e){(e=b(e.target).closest("li"))&&f!==this&&e.addClass(a.classes.highlightedToken)}).mouseout(function(e){(e=b(e.target).closest("li"))&&f!==this&&e.removeClass(a.classes.highlightedToken)}).insertBefore(i),p=b("<li />").addClass(a.classes.inputToken).appendTo(q).append(g),
s=b("<div>").addClass(a.classes.dropdown).appendTo("body").hide(),M=b("<tester/>").insertAfter(g).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:g.css("fontSize"),fontFamily:g.css("fontFamily"),fontWeight:g.css("fontWeight"),letterSpacing:g.css("letterSpacing"),whiteSpace:"nowrap"});i.val("");h=a.prePopulate||i.data("pre");a.processPrePopulate&&b.isFunction(a.onResult)&&(h=a.onResult.call(i,h));h&&h.length&&b.each(h,function(a,b){J(b);r()});b.isFunction(a.onReady)&&a.onReady.call();
this.clear=function(){q.children("li").each(function(){0===b(this).children("input").length&&y(b(this))})};this.add=function(a){D(a)};this.remove=function(a){q.children("li").each(function(){if(0===b(this).children("input").length){var c=b(this).data("tokeninput"),d=!0,f;for(f in a)if(a[f]!==c[f]){d=!1;break}d&&y(b(this))}})};this.getTokens=function(){return l}};b.TokenList.Cache=function(h){var j=b.extend({max_size:500},h),a={},r=0;this.add=function(b,h){r>j.max_size&&(a={},r=0);a[b]||(r+=1);a[b]=
h};this.get=function(b){return a[b]}}})(jQuery);
