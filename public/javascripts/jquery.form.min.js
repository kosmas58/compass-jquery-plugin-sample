(function(b){function p(){if(b.fn.ajaxSubmit.debug){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log)window.console.log(a);else window.opera&&window.opera.postError&&window.opera.postError(a)}}b.fn.ajaxSubmit=function(a){function f(){function x(){var h=k.attr("target"),l=k.attr("action");n.setAttribute("target",v);n.getAttribute("method")!="POST"&&n.setAttribute("method","POST");n.getAttribute("action")!=c.url&&n.setAttribute("action",c.url);c.skipEncodingOverride||
k.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});c.timeout&&setTimeout(function(){D=true;r()},c.timeout);var s=[];try{if(c.extraData)for(var t in c.extraData)s.push(b('<input type="hidden" name="'+t+'" value="'+c.extraData[t]+'" />').appendTo(n)[0]);u.appendTo("body");q.attachEvent?q.attachEvent("onload",r):q.addEventListener("load",r,false);n.submit()}finally{n.setAttribute("action",l);h?n.setAttribute("target",h):k.removeAttr("target");b(s).remove()}}function r(){if(!j.aborted){var h=
q.contentWindow?q.contentWindow.document:q.contentDocument?q.contentDocument:q.document;if(!(!h||h.location.href==c.iframeSrc)){q.detachEvent?q.detachEvent("onload",r):q.removeEventListener("load",r,false);var l=true;try{if(D)throw"timeout";var s=c.dataType=="xml"||h.XMLDocument||b.isXMLDoc(h);p("isXml="+s);if(!s&&window.opera&&(h.body==null||h.body.innerHTML==""))if(--H){p("requeing onLoad callback, DOM not available");setTimeout(r,250);return}j.responseText=h.body?h.body.innerHTML:h.documentElement?
h.documentElement.innerHTML:null;j.responseXML=h.XMLDocument?h.XMLDocument:h;j.getResponseHeader=function(I){return{"content-type":c.dataType}[I]};var t=/(json|script)/.test(c.dataType);if(t||c.textarea){var y=h.getElementsByTagName("textarea")[0];if(y)j.responseText=y.value;else if(t){var E=h.getElementsByTagName("pre")[0],F=h.getElementsByTagName("body")[0];if(E)j.responseText=E.textContent;else if(F)j.responseText=F.innerHTML}}else if(c.dataType=="xml"&&!j.responseXML&&j.responseText!=null)j.responseXML=
J(j.responseText);G=K(j,c.dataType,c)}catch(A){p("error caught:",A);l=false;j.error=A;c.error&&c.error.call(c.context,j,"error",A);w&&b.event.trigger("ajaxError",[j,c,A])}if(j.aborted){p("upload aborted");l=false}if(l){c.success&&c.success.call(c.context,G,"success",j);w&&b.event.trigger("ajaxSuccess",[j,c])}w&&b.event.trigger("ajaxComplete",[j,c]);w&&!--b.active&&b.event.trigger("ajaxStop");c.complete&&c.complete.call(c.context,j,l?"success":"error");setTimeout(function(){u.removeData("form-plugin-onload");
u.remove();j.responseXML=null},100)}}}var n=k[0];if(b(":input[name=submit],:input[id=submit]",n).length)alert('Error: Form elements must not have name or id of "submit".');else{var c=b.extend(true,{},b.ajaxSettings,a);c.context=c.context||c;var v="jqFormIO"+(new Date).getTime(),u=b('<iframe id="'+v+'" name="'+v+'" src="'+c.iframeSrc+'" />'),q=u[0];u.css({position:"absolute",top:"-1000px",left:"-1000px"});var j={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},
getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){p("aborting upload...");this.aborted=1;u.attr("src",c.iframeSrc);j.error="aborted";c.error&&c.error.call(c.context,j,"error","aborted");w&&b.event.trigger("ajaxError",[j,c,"aborted"]);c.complete&&c.complete.call(c.context,j,"error")}},w=c.global;w&&!b.active++&&b.event.trigger("ajaxStart");w&&b.event.trigger("ajaxSend",[j,c]);if(c.beforeSend&&c.beforeSend.call(c.context,j,c)===false)c.global&&b.active--;else if(!j.aborted){var D=
0,z=n.clk;if(z){var B=z.name;if(B&&!z.disabled){c.extraData=c.extraData||{};c.extraData[B]=z.value;if(z.type=="image"){c.extraData[B+".x"]=n.clk_x;c.extraData[B+".y"]=n.clk_y}}}c.forceSync?x():setTimeout(x,10);var G,H=50,J=b.parseXML||function(h,l){if(window.ActiveXObject){l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML(h)}else l=(new DOMParser).parseFromString(h,"text/xml");return l&&l.documentElement&&l.documentElement.nodeName!="parsererror"?l:null},L=b.parseJSON||function(h){return window.eval("("+
h+")")},K=function(h,l,s){var t=h.getResponseHeader("content-type")||"",y=l==="xml"||!l&&t.indexOf("xml")>=0;h=y?h.responseXML:h.responseText;y&&h.documentElement.nodeName==="parsererror"&&b.error&&b.error("parsererror");if(s&&s.dataFilter)h=s.dataFilter(h,l);if(typeof h==="string")if(l==="json"||!l&&t.indexOf("json")>=0)h=L(h);else if(l==="script"||!l&&t.indexOf("javascript")>=0)b.globalEval(h);return h}}}}if(!this.length){p("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof a==
"function")a={success:a};var e=this.attr("action");if(e=typeof e==="string"?b.trim(e):"")e=(e.match(/^([^#]+)/)||[])[1];e=e||window.location.href||"";a=b.extend(true,{url:e,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a);e={};this.trigger("form-pre-serialize",[this,a,e]);if(e.veto){p("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(a.beforeSerialize&&a.beforeSerialize(this,a)===false){p("ajaxSubmit: submit aborted via beforeSerialize callback");
return this}var d,i,g=this.formToArray(a.semantic);if(a.data){a.extraData=a.data;for(d in a.data)if(a.data[d]instanceof Array)for(var m in a.data[d])g.push({name:d,value:a.data[d][m]});else{i=a.data[d];i=b.isFunction(i)?i():i;g.push({name:d,value:i})}}if(a.beforeSubmit&&a.beforeSubmit(g,this,a)===false){p("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[g,this,a,e]);if(e.veto){p("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}d=
b.param(g);if(a.type.toUpperCase()=="GET"){a.url+=(a.url.indexOf("?")>=0?"&":"?")+d;a.data=null}else a.data=d;var k=this,o=[];a.resetForm&&o.push(function(){k.resetForm()});a.clearForm&&o.push(function(){k.clearForm()});if(!a.dataType&&a.target){var C=a.success||function(){};o.push(function(x){var r=a.replaceTarget?"replaceWith":"html";b(a.target)[r](x).each(C,arguments)})}else a.success&&o.push(a.success);a.success=function(x,r,n){for(var c=a.context||a,v=0,u=o.length;v<u;v++)o[v].apply(c,[x,r,n||
k,k])};d=b("input:file",this).length>0;m=k.attr("enctype")=="multipart/form-data"||k.attr("encoding")=="multipart/form-data";if(a.iframe!==false&&(d||a.iframe||m))a.closeKeepAlive?b.get(a.closeKeepAlive,f):f();else b.ajax(a);this.trigger("form-submit-notify",[this,a]);return this};b.fn.ajaxForm=function(a){if(this.length===0){var f={s:this.selector,c:this.context};if(!b.isReady&&f.s){p("DOM not ready, queuing ajaxForm");b(function(){b(f.s,f.c).ajaxForm(a)});return this}p("terminating; zero elements found by selector"+
(b.isReady?"":" (DOM not ready)"));return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){if(!e.isDefaultPrevented()){e.preventDefault();b(this).ajaxSubmit(a)}}).bind("click.form-plugin",function(e){var d=e.target,i=b(d);if(!i.is(":submit,input:image")){d=i.closest(":submit");if(d.length==0)return;d=d[0]}var g=this;g.clk=d;if(d.type=="image")if(e.offsetX!=undefined){g.clk_x=e.offsetX;g.clk_y=e.offsetY}else if(typeof b.fn.offset=="function"){i=i.offset();g.clk_x=e.pageX-i.left;
g.clk_y=e.pageY-i.top}else{g.clk_x=e.pageX-d.offsetLeft;g.clk_y=e.pageY-d.offsetTop}setTimeout(function(){g.clk=g.clk_x=g.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(a){var f=[];if(this.length===0)return f;var e=this[0],d=a?e.getElementsByTagName("*"):e.elements;if(!d)return f;var i,g,m,k,o,C;i=0;for(o=d.length;i<o;i++){g=d[i];if(m=g.name)if(a&&e.clk&&g.type=="image"){if(!g.disabled&&e.clk==g){f.push({name:m,
value:b(g).val()});f.push({name:m+".x",value:e.clk_x},{name:m+".y",value:e.clk_y})}}else if((k=b.fieldValue(g,true))&&k.constructor==Array){g=0;for(C=k.length;g<C;g++)f.push({name:m,value:k[g]})}else k!==null&&typeof k!="undefined"&&f.push({name:m,value:k})}if(!a&&e.clk){a=b(e.clk);d=a[0];if((m=d.name)&&!d.disabled&&d.type=="image"){f.push({name:m,value:a.val()});f.push({name:m+".x",value:e.clk_x},{name:m+".y",value:e.clk_y})}}return f};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};
b.fn.fieldSerialize=function(a){var f=[];this.each(function(){var e=this.name;if(e){var d=b.fieldValue(this,a);if(d&&d.constructor==Array)for(var i=0,g=d.length;i<g;i++)f.push({name:e,value:d[i]});else d!==null&&typeof d!="undefined"&&f.push({name:this.name,value:d})}});return b.param(f)};b.fn.fieldValue=function(a){for(var f=[],e=0,d=this.length;e<d;e++){var i=b.fieldValue(this[e],a);i===null||typeof i=="undefined"||i.constructor==Array&&!i.length||(i.constructor==Array?b.merge(f,i):f.push(i))}return f};
b.fieldValue=function(a,f){var e=a.name,d=a.type,i=a.tagName.toLowerCase();if(f===undefined)f=true;if(f&&(!e||a.disabled||d=="reset"||d=="button"||(d=="checkbox"||d=="radio")&&!a.checked||(d=="submit"||d=="image")&&a.form&&a.form.clk!=a||i=="select"&&a.selectedIndex==-1))return null;if(i=="select"){var g=a.selectedIndex;if(g<0)return null;e=[];i=a.options;var m=(d=d=="select-one")?g+1:i.length;for(g=d?g:0;g<m;g++){var k=i[g];if(k.selected){var o=k.value;o||(o=k.attributes&&k.attributes.value&&!k.attributes.value.specified?
k.text:k.value);if(d)return o;e.push(o)}}return e}return b(a).val()};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,f=this.tagName.toLowerCase();if(a=="text"||a=="password"||f=="textarea")this.value="";else if(a=="checkbox"||a=="radio")this.checked=false;else if(f=="select")this.selectedIndex=-1})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset==
"function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};b.fn.enable=function(a){if(a===undefined)a=true;return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){if(a===undefined)a=true;return this.each(function(){var f=this.type;if(f=="checkbox"||f=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option"){f=b(this).parent("select");a&&f[0]&&f[0].type=="select-one"&&f.find("option").selected(false);this.selected=a}})}})(jQuery);
