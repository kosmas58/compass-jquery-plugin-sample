(function(a){function m(e,b,c){if(jQuery.isFunction(b)){c=b;b=null}var h=e+"?"+a.param(b||{});if(j[h])return false;j[h]=true;return jQuery.ajax({type:"GET",url:e,data:b,success:function(i,n){delete j[h];if(undefined===i)window.navigator.onLine||(k=function(){m(e,b,c)});else c(i,n)},error:function(){delete j[h]},dataType:"json",ifModified:true})}var k=null,j={};if(typeof a.support.localStorage==="undefined")a.support.localStorage=!!window.localStorage;if(a.support.localStorage){a(window).bind("online",
function(){k&&k()});a(window).bind("offline",function(){jQuery.event.trigger("ajaxStop")});a.retrieveJSON=function(e,b,c){function h(){for(var g=[],d=0;d<localStorage.length;++d){var f=localStorage.key(d);/:date$/.test(f)&&g.push(f)}g.sort(function(s,t){var p=localStorage[s],q=localStorage[t];return p<q?-1:p>q?+1:0});for(d=0;d<g.length/2;++d){f=g[d];delete localStorage[f];delete localStorage[f.substr(0,f.length-5)]}}function i(){m(e,b,function(g,d){if(d=="notmodified")return false;for(;;)try{localStorage[l]=
JSON.stringify(g);localStorage[l+":date"]=new Date;break}catch(f){if(f.name=="QUOTA_EXCEEDED_ERR"||f.name=="NS_ERROR_DOM_QUOTA_REACHED")h()}c(g,d,o&&{cachedAt:r,retrievedAt:n})})}if(a.isFunction(b)){c=b;b={}}var n=new Date,u=a.param(b),l="offline.jquery:"+e+":"+u,o=localStorage[l],r=new Date(Date.parse(localStorage[l+":date"]));if(o)if(c(a.parseJSON(o),"cached",{cachedAt:r})===false)return false;if(window.navigator.onLine)i();else k=i;return true};a.clearJSON=function(e,b){var c=a.param(b||{});delete localStorage["offline.jquery:"+
e+":"+c];delete localStorage["offline.jquery:"+e+":"+c+":date"]}}else{a.retrieveJSON=m;a.clearJSON=a.noop}})(jQuery);
