(function(){var F=tinymce.each,s=tinymce.dom.Event,D;function u(a,b){while(a&&(a.nodeType===8||(a.nodeType===3&&/^[ \t\n\r]*$/.test(a.nodeValue)))){a=b(a)}return a}function I(a){return u(a,function(b){return b.previousSibling})}function B(a){return u(a,function(b){return b.nextSibling})}function G(c,a,b){return c.dom.getParent(a,function(d){return tinymce.inArray(b,d)!==-1})}function w(a){return a&&(a.tagName==="OL"||a.tagName==="UL")}function H(c,b){var d,a,e;d=I(c.lastChild);while(w(d)){a=d;d=I(a.previousSibling)}if(a){e=b.create("li",{style:"list-style-type: none;"});b.split(c,a);b.insertAfter(e,a);e.appendChild(a);e.appendChild(a);c=e.previousSibling}return c}function x(b,c,a){b=J(b,c,a);return v(b,c,a)}function J(b,d,a){var c=I(b.previousSibling);if(c){return C(c,b,d?c:false,a)}else{return b}}function v(b,c,a){var d=B(b.nextSibling);if(d){return C(b,d,c?d:false,a)}else{return b}}function C(b,d,c,a){if(y(b,d,!!c,a)){return E(b,d,c)}else{if(b&&b.tagName==="LI"&&w(d)){b.appendChild(d)}}return d}function y(b,c,d,a){if(!b||!c){return false}else{if(b.tagName==="LI"&&c.tagName==="LI"){return c.style.listStyleType==="none"||A(c)}else{if(w(b)){return(b.tagName===c.tagName&&(d||b.style.listStyleType===c.style.listStyleType))||t(c)}else{if(a&&b.tagName==="P"&&c.tagName==="P"){return true}else{return false}}}}}function t(b){var c=B(b.firstChild),a=I(b.lastChild);return c&&a&&w(b)&&c===a&&(w(c)||c.style.listStyleType==="none"||A(c))}function A(a){var b=B(a.firstChild),c=I(a.lastChild);return b&&c&&b===c&&w(b)}function E(a,b,e){var c=I(a.lastChild),d=B(b.firstChild);if(a.tagName==="P"){a.appendChild(a.ownerDocument.createElement("br"))}while(b.firstChild){a.appendChild(b.firstChild)}if(e){a.style.listStyleType=e.style.listStyleType}b.parentNode.removeChild(b);C(c,d,false);return a}function z(b,a){var c;if(!a.is(b,"li,ol,ul")){c=a.getParent(b,"li");if(c){b=c}}return b}tinymce.create("tinymce.plugins.Lists",{init:function(d,c){var f=false;function a(g){return g.keyCode===9&&(d.queryCommandState("InsertUnorderedList")||d.queryCommandState("InsertOrderedList"))}function b(j,g){var h=j.selection,i;if(g.keyCode===13){i=h.getStart();f=h.isCollapsed()&&i&&i.tagName==="LI"&&i.childNodes.length===0;return f}}function e(h,g){if(a(g)||b(h,g)){return s.cancel(g)}}this.ed=d;d.addCommand("Indent",this.indent,this);d.addCommand("Outdent",this.outdent,this);d.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this);d.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this);d.onInit.add(function(){d.editorCommands.addCommands({outdent:function(){var h=d.selection,g=d.dom;function i(j){j=g.getParent(j,g.isBlock);return j&&(parseInt(d.dom.getStyle(j,"margin-left")||0,10)+parseInt(d.dom.getStyle(j,"padding-left")||0,10))>0}return i(h.getStart())||i(h.getEnd())||d.queryCommandState("InsertOrderedList")||d.queryCommandState("InsertUnorderedList")}},"state")});d.onKeyUp.add(function(h,g){var j,i;if(a(g)){h.execCommand(g.shiftKey?"Outdent":"Indent",true,null);return s.cancel(g)}else{if(f&&b(h,g)){if(h.queryCommandState("InsertOrderedList")){h.execCommand("InsertOrderedList")}else{h.execCommand("InsertUnorderedList")}j=h.selection.getStart();if(j&&j.tagName==="LI"){j=h.dom.getParent(j,"ol,ul").nextSibling;if(j&&j.tagName==="P"){if(!j.firstChild){j.appendChild(h.getDoc().createTextNode(""))}i=h.dom.createRng();i.setStart(j.firstChild,1);i.setEnd(j.firstChild,1);h.selection.setRng(i)}}return s.cancel(g)}}});d.onKeyPress.add(e);d.onKeyDown.add(e)},applyList:function(d,j){var p=this,b=p.ed,f=b.dom,n=[],g=false,l=false,h=false,q,i=b.selection.getSelectedBlocks();function m(K){if(K&&K.tagName==="BR"){f.remove(K)}}function k(Q){var P=f.create(d),O;function K(L){if(L.style.marginLeft||L.style.paddingLeft){p.adjustPaddingFunction(false)(L)}}if(Q.tagName==="LI"){}else{if(Q.tagName==="P"||Q.tagName==="DIV"||Q.tagName==="BODY"){a(Q,function(M,N,L){c(M,N,Q.tagName==="BODY"?null:M.parentNode);O=M.parentNode;K(O);m(N)});if(Q.tagName==="P"||i.length>1){f.split(O.parentNode.parentNode,O.parentNode)}x(O.parentNode,true);return}else{O=f.create("li");f.insertAfter(O,Q);O.appendChild(Q);K(Q);Q=O}}f.insertAfter(P,Q);P.appendChild(Q);x(P,true);n.push(Q)}function c(S,K,U){var R,T=S,V,W;while(!f.isBlock(S.parentNode)&&S.parentNode!==f.getRoot()){S=f.split(S.parentNode,S.previousSibling);S=S.nextSibling;T=S}if(U){R=U.cloneNode(true);S.parentNode.insertBefore(R,S);while(R.firstChild){f.remove(R.firstChild)}R=f.rename(R,"li")}else{R=f.create("li");S.parentNode.insertBefore(R,S)}while(T&&T!=K){V=T.nextSibling;R.appendChild(T);T=V}if(R.childNodes.length===0){R.innerHTML='<br _mce_bogus="1" />'}k(R)}function a(W,K){var Z,V,Y=3,ab=1,ac="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";function X(O,N){var M=f.createRng(),L;D.keep=true;b.selection.moveToBookmark(D);D.keep=false;L=b.selection.getRng(true);if(!N){N=O.parentNode.lastChild}M.setStartBefore(O);M.setEndAfter(N);return !(M.compareBoundaryPoints(Y,L)>0||M.compareBoundaryPoints(ab,L)<=0)}function U(L){if(L.nextSibling){return L.nextSibling}if(!f.isBlock(L.parentNode)&&L.parentNode!==f.getRoot()){return U(L.parentNode)}}Z=W.firstChild;var aa=false;F(f.select(ac,W),function(L){var M;if(L.hasAttribute&&L.hasAttribute("_mce_bogus")){return true}if(X(Z,L)){f.addClass(L,"_mce_tagged_br");Z=U(L)}});aa=(Z&&X(Z,undefined));Z=W.firstChild;F(f.select(ac,W),function(L){var M=U(L);if(L.hasAttribute&&L.hasAttribute("_mce_bogus")){return true}if(f.hasClass(L,"_mce_tagged_br")){K(Z,L,V);V=null}else{V=L}Z=M});if(aa){K(Z,undefined,V)}}function o(K){a(K,function(Q,O,P){c(Q,O);m(O);m(P)})}function r(K){if(tinymce.inArray(n,K)!==-1){return}if(K.parentNode.tagName===j){f.split(K.parentNode,K);k(K);v(K.parentNode,false)}n.push(K)}function e(S){var Q,R,K,P;if(tinymce.inArray(n,S)!==-1){return}S=H(S,f);while(f.is(S.parentNode,"ol,ul,li")){f.split(S.parentNode,S)}n.push(S);S=f.rename(S,"p");K=x(S,false,b.settings.force_br_newlines);if(K===S){Q=S.firstChild;while(Q){if(f.isBlock(Q)){Q=f.split(Q.parentNode,Q);P=true;R=Q.nextSibling&&Q.nextSibling.firstChild}else{R=Q.nextSibling;if(P&&Q.tagName==="BR"){f.remove(Q)}P=false}Q=R}}}F(i,function(K){K=z(K,f);if(K.tagName===j||(K.tagName==="LI"&&K.parentNode.tagName===j)){l=true}else{if(K.tagName===d||(K.tagName==="LI"&&K.parentNode.tagName===d)){g=true}else{h=true}}});if(h||l||i.length===0){q={LI:r,H1:k,H2:k,H3:k,H4:k,H5:k,H6:k,P:k,BODY:k,DIV:i.length>1?k:o,defaultAction:o}}else{q={defaultAction:e}}this.process(q)},indent:function(){var d=this.ed,b=d.dom,a=[];function f(g){var h=b.create("li",{style:"list-style-type: none;"});b.insertAfter(h,g);return h}function e(m){var l=f(m),i=b.getParent(m,"ol,ul"),k=i.tagName,h=b.getStyle(i,"list-style-type"),g={},j;if(h!==""){g.style="list-style-type: "+h+";"}j=b.create(k,g);l.appendChild(j);return j}function c(g){if(!G(d,g,a)){g=H(g,b);var h=e(g);h.appendChild(g);x(h.parentNode,false);x(h,false);a.push(g)}}this.process({LI:c,defaultAction:this.adjustPaddingFunction(true)})},outdent:function(){var c=this,d=c.ed,b=d.dom,e=[];function a(g){var h,i,f;if(!G(d,g,e)){if(b.getStyle(g,"margin-left")!==""||b.getStyle(g,"padding-left")!==""){return c.adjustPaddingFunction(false)(g)}f=b.getStyle(g,"text-align",true);if(f==="center"||f==="right"){b.setStyle(g,"text-align","left");return}g=H(g,b);h=g.parentNode;i=g.parentNode.parentNode;if(i.tagName==="P"){b.split(i,g.parentNode)}else{b.split(h,g);if(i.tagName==="LI"){b.split(i,g)}else{if(!b.is(i,"ol,ul")){b.rename(g,"p")}}}e.push(g)}}this.process({LI:a,defaultAction:this.adjustPaddingFunction(false)});F(e,x)},process:function(e){var a=this,g=a.ed.selection,d=a.ed.dom,b,i;function f(j){d.removeClass(j,"_mce_act_on");if(!j||j.nodeType!==1){return}j=z(j,d);var k=e[j.tagName];if(!k){k=e.defaultAction}k(j)}function h(j){a.splitSafeEach(j.childNodes,f)}function c(j,k){return k>=0&&j.hasChildNodes()&&k<j.childNodes.length&&j.childNodes[k].tagName==="BR"}b=g.getSelectedBlocks();if(b.length===0){b=[d.getRoot()]}i=g.getRng(true);if(!i.collapsed){if(c(i.endContainer,i.endOffset-1)){i.setEnd(i.endContainer,i.endOffset-1);g.setRng(i)}if(c(i.startContainer,i.startOffset)){i.setStart(i.startContainer,i.startOffset+1);g.setRng(i)}}D=g.getBookmark();e.OL=e.UL=h;a.splitSafeEach(b,f);g.moveToBookmark(D);D=null;a.ed.execCommand("mceRepaint")},splitSafeEach:function(a,b){if(tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))){this.classBasedEach(a,b)}else{F(a,b)}},classBasedEach:function(b,c){var a=this.ed.dom,e,d;F(b,function(f){a.addClass(f,"_mce_act_on")});e=a.select("._mce_act_on");while(e.length>0){d=e.shift();a.removeClass(d,"_mce_act_on");c(d);e=a.select("._mce_act_on")}},adjustPaddingFunction:function(b){var d,a,c=this.ed;d=c.settings.indentation;a=/[a-z%]+/i.exec(d);d=parseInt(d,10);return function(f){var g,e;g=parseInt(c.dom.getStyle(f,"margin-left")||0,10)+parseInt(c.dom.getStyle(f,"padding-left")||0,10);if(b){e=g+d}else{e=g-d}c.dom.setStyle(f,"padding-left","");c.dom.setStyle(f,"margin-left",e>0?e+a:"")}},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}());