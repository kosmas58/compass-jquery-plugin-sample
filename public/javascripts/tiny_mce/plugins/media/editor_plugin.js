(function(){var o=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),k=tinymce.makeMap(o.join(",")),i=tinymce.html.Node,m,j,l=tinymce.util.JSON,n;m=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"]];function p(a){var b,d,c;if(a&&!a.splice){d=[];for(c=0;true;c++){if(a[c]){d[c]=a[c]}else{break}}return d}return a}tinymce.create("tinymce.plugins.MediaPlugin",{init:function(e,s){var a=this,g={},f,c,b,h;function d(q){return q&&q.nodeName==="IMG"&&e.dom.hasClass(q,"mceItemMedia")}a.editor=e;a.url=s;j="";for(f=0;f<m.length;f++){h=m[f][0];b={name:h,clsids:tinymce.explode(m[f][1]||""),mimes:tinymce.explode(m[f][2]||""),codebase:m[f][3]};for(c=0;c<b.clsids.length;c++){g["clsid:"+b.clsids[c]]=b}for(c=0;c<b.mimes.length;c++){g[b.mimes[c]]=b}g["mceItem"+h]=b;g[h.toLowerCase()]=b;j+=(j?"|":"")+h}tinymce.each(e.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mp3,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar").split(";"),function(q){var x,r,w;q=q.split(/=/);r=tinymce.explode(q[1].toLowerCase());for(x=0;x<r.length;x++){w=g[q[0].toLowerCase()];if(w){g[r[x]]=w}}});j=new RegExp("write("+j+")\\(([^)]+)\\)");a.lookup=g;e.onPreInit.add(function(){e.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");e.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(r){var q=r.length;while(q--){a.objectToImg(r[q])}});e.serializer.addNodeFilter("img",function(z,x,y){var r=z.length,q;while(r--){q=z[r];if((q.attr("class")||"").indexOf("mceItemMedia")!==-1){a.imgToObject(q,y)}}})});e.onInit.add(function(){if(e.theme&&e.theme.onResolveName){e.theme.onResolveName.add(function(q,r){if(r.name==="img"&&e.dom.hasClass(r.node,"mceItemMedia")){r.name="media"}})}if(e&&e.plugins.contextmenu){e.plugins.contextmenu.onContextMenu.add(function(u,r,q){if(q.nodeName==="IMG"&&q.className.indexOf("mceItemMedia")!==-1){r.add({title:"media.edit",icon:"media",cmd:"mceMedia"})}})}});e.addCommand("mceMedia",function(){var r,q;q=e.selection.getNode();if(d(q)){r=l.parse(e.dom.getAttrib(q,"data-mce-json"));tinymce.each(o,function(w){var v=e.dom.getAttrib(q,w);if(v){r[w]=v}});r.type=a.getType(q.className).name.toLowerCase()}if(!r){r={type:"flash",video:{sources:[]},params:{}}}e.windowManager.open({file:s+"/media.htm",width:430+parseInt(e.getLang("media.delta_width",0)),height:500+parseInt(e.getLang("media.delta_height",0)),inline:1},{plugin_url:s,data:r})});e.addButton("media",{title:"media.desc",cmd:"mceMedia"});e.onNodeChange.add(function(u,r,q){r.setActive("media",d(q))})},convertUrl:function(c,g){var d=this,a=d.editor,b=a.settings,f=b.url_converter,e=b.url_converter_scope||d;if(!c){return c}if(g){return a.documentBaseURI.toAbsolute(c)}return f.call(e,c,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(f,h){var a=this,d=a.editor,c=d.documentBaseURI,s,b,e,g;f.params.src=a.convertUrl(f.params.src,h);b=f.video.attrs;if(b){b.src=a.convertUrl(b.src,h)}if(b){b.poster=a.convertUrl(b.poster,h)}s=p(f.video.sources);if(s){for(g=0;g<s.length;g++){s[g].src=a.convertUrl(s[g].src,h)}}e=a.editor.dom.create("img",{id:f.id,style:f.style,align:f.align,src:a.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+a.getType(f.type).name,"data-mce-json":l.serialize(f,"'")});e.width=f.width||"320";e.height=f.height||"240";return e},dataToHtml:function(b,a){return this.editor.serializer.serialize(this.dataToImg(b,a),{force_absolute:a})},htmlToData:function(b){var c,d,a;a={type:"flash",video:{sources:[]},params:{}};c=this.editor.parser.parse(b);d=c.getAll("img")[0];if(d){a=l.parse(d.attr("data-mce-json"));a.type=this.getType(d.attr("class")).name.toLowerCase();tinymce.each(o,function(e){var f=d.attr(e);if(f){a[e]=f}})}return a},getType:function(a){var c,d,b;d=tinymce.explode(a," ");for(c=0;c<d.length;c++){b=this.lookup[d[c]];if(b){return b}}},imgToObject:function(c,Q){var G=this,P=G.editor,N,h,U,H,f,d,I,g,T,J,K,O,b,M,R,e,S,a;function L(v,w){var r,s,q,t,u;u=P.getParam("flash_video_player_url",G.convertUrl(G.url+"/moxieplayer.swf"));if(u){r=P.documentBaseURI;I.params.src=u;if(P.getParam("flash_video_player_absvideourl",true)){v=r.toAbsolute(v||"",true);w=r.toAbsolute(w||"",true)}q="";s=P.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"});tinymce.each(s,function(x,y){x=x.replace(/\$url/,v||"");x=x.replace(/\$poster/,w||"");if(x.length>0){q+=(q?"&":"")+y+"="+escape(x)}});if(q.length){I.params.flashvars=q}t=P.getParam("flash_video_player_params",{allowfullscreen:true,allowscriptaccess:true});tinymce.each(t,function(x,y){I.params[y]=""+x})}}I=l.parse(c.attr("data-mce-json"));O=this.getType(c.attr("class"));a=c.attr("data-mce-style");if(!a){a=c.attr("style");if(a){a=P.dom.serializeStyle(P.dom.parseStyle(a,"img"))}}if(O.name==="Iframe"){e=new i("iframe",1);tinymce.each(o,function(q){var r=c.attr(q);if(q=="class"&&r){r=r.replace(/mceItem.+ ?/g,"")}if(r&&r.length>0){e.attr(q,r)}});for(f in I.params){e.attr(f,I.params[f])}e.attr({style:a,src:I.params.src});c.replace(e);return}if(this.editor.settings.media_use_script){e=new i("script",1).attr("type","text/javascript");d=new i("#text",3);d.value="write"+O.name+"("+l.serialize(tinymce.extend(I.params,{width:c.attr("width"),height:c.attr("height")}))+");";e.append(d);c.replace(e);return}if(O.name==="Video"&&I.video.sources[0]){N=new i("video",1).attr(tinymce.extend({id:c.attr("id"),width:c.attr("width"),height:c.attr("height"),style:a},I.video.attrs));if(I.video.attrs){S=I.video.attrs.poster}T=I.video.sources=p(I.video.sources);for(b=0;b<T.length;b++){if(/\.mp4$/.test(T[b].src)){R=T[b].src}}if(!T[0].type){N.attr("src",T[0].src);T.splice(0,1)}for(b=0;b<T.length;b++){g=new i("source",1).attr(T[b]);g.shortEnded=true;N.append(g)}if(R){L(R,S);O=G.getType("flash")}else{I.params.src=""}}if(I.params.src){if(/\.flv$/i.test(I.params.src)){L(I.params.src,"")}if(Q&&Q.force_absolute){I.params.src=P.documentBaseURI.toAbsolute(I.params.src)}h=new i("object",1).attr({id:c.attr("id"),width:c.attr("width"),height:c.attr("height"),style:a});tinymce.each(o,function(q){if(I[q]&&q!="type"){h.attr(q,I[q])}});for(f in I.params){K=new i("param",1);K.shortEnded=true;d=I.params[f];if(f==="src"&&O.name==="WindowsMedia"){f="url"}K.attr({name:f,value:d});h.append(K)}if(this.editor.getParam("media_strict",true)){h.attr({data:I.params.src,type:O.mimes[0]})}else{h.attr({classid:"clsid:"+O.clsids[0],codebase:O.codebase});U=new i("embed",1);U.shortEnded=true;U.attr({id:c.attr("id"),width:c.attr("width"),height:c.attr("height"),style:a,type:O.mimes[0]});for(f in I.params){U.attr(f,I.params[f])}tinymce.each(o,function(q){if(I[q]&&q!="type"){U.attr(q,I[q])}});h.append(U)}if(I.object_html){d=new i("#text",3);d.raw=true;d.value=I.object_html;h.append(d)}if(N){N.append(h)}}if(N){if(I.video_html){d=new i("#text",3);d.raw=true;d.value=I.video_html;N.append(d)}}if(N||h){c.replace(N||h)}else{c.remove()}},objectToImg:function(b){var h,Y,R,S,g,d,I,e,K,P,a,Q,T,M,c,X,J,U,O=this.lookup,W,f,L=this.editor.settings.url_converter,V=this.editor.settings.url_converter_scope;function N(q){return new tinymce.html.Serializer({inner:true,validate:false}).serialize(q)}if(!b.parent){return}if(b.name==="script"){if(b.firstChild){W=j.exec(b.firstChild.value)}if(!W){return}U=W[1];J={video:{},params:l.parse(W[2])};e=J.params.width;K=J.params.height}J=J||{video:{},params:{}};g=new i("img",1);g.attr({src:this.editor.theme.url+"/img/trans.gif"});d=b.name;if(d==="video"){R=b;h=b.getAll("object")[0];Y=b.getAll("embed")[0];e=R.attr("width");K=R.attr("height");I=R.attr("id");J.video={attrs:{},sources:[]};f=J.video.attrs;for(d in R.attributes.map){f[d]=R.attributes.map[d]}c=b.attr("src");if(c){J.video.sources.push({src:L.call(V,c,"src","video")})}X=R.getAll("source");for(a=0;a<X.length;a++){c=X[a].remove();J.video.sources.push({src:L.call(V,c.attr("src"),"src","source"),type:c.attr("type"),media:c.attr("media")})}if(f.poster){f.poster=L.call(V,f.poster,"poster","video")}}if(b.name==="object"){h=b;Y=b.getAll("embed")[0]}if(b.name==="embed"){Y=b}if(b.name==="iframe"){S=b;U="Iframe"}if(h){e=e||h.attr("width");K=K||h.attr("height");P=P||h.attr("style");I=I||h.attr("id");M=h.getAll("param");for(a=0;a<M.length;a++){T=M[a];d=T.remove().attr("name");if(!k[d]){J.params[d]=T.attr("value")}}J.params.src=J.params.src||h.attr("data")}if(Y){e=e||Y.attr("width");K=K||Y.attr("height");P=P||Y.attr("style");I=I||Y.attr("id");for(d in Y.attributes.map){if(!k[d]&&!J.params[d]){J.params[d]=Y.attributes.map[d]}}}if(S){e=S.attr("width");K=S.attr("height");P=P||S.attr("style");I=S.attr("id");tinymce.each(o,function(q){g.attr(q,S.attr(q))});for(d in S.attributes.map){if(!k[d]&&!J.params[d]){J.params[d]=S.attributes.map[d]}}}if(J.params.movie){J.params.src=J.params.src||J.params.movie;delete J.params.movie}if(J.params.src){J.params.src=L.call(V,J.params.src,"src","object")}if(R){U=O.video.name}if(h&&!U){U=(O[(h.attr("clsid")||"").toLowerCase()]||O[(h.attr("type")||"").toLowerCase()]||{}).name}if(Y&&!U){U=(O[(Y.attr("type")||"").toLowerCase()]||{}).name}b.replace(g);if(Y){Y.remove()}if(h){Q=N(h.remove());if(Q){J.object_html=Q}}if(R){Q=N(R.remove());if(Q){J.video_html=Q}}g.attr({id:I,"class":"mceItemMedia mceItem"+(U||"Flash"),style:P,width:e||"320",height:K||"240","data-mce-json":l.serialize(J,"'")})}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();