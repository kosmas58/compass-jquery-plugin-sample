(function(h){var g=h.each;function e(d,c){var b=c.ownerDocument,k=b.createRange(),a;k.setStartBefore(c);k.setEnd(d.endContainer,d.endOffset);a=b.createElement("body");a.appendChild(k.cloneContents());return a.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function f(O,Q,b){var al,a,W,ad;U();ad=Q.getParent(b.getStart(),"th,td");if(ad){a=R(ad);W=M();ad=c(a.x,a.y)}function ac(j,k){j=j.cloneNode(k);j.removeAttribute("id");return j}function U(){var j=0;al=[];g(["thead","tbody","tfoot"],function(l){var k=Q.select("> "+l+" tr",O);g(k,function(n,m){m+=j;g(Q.select("> td, > th",n),function(o,t){var s,r,q,p;if(al[m]){while(al[m][t]){t++}}q=aj(o,"rowspan");p=aj(o,"colspan");for(r=m;r<m+q;r++){if(!al[r]){al[r]=[]}for(s=t;s<t+p;s++){al[r][s]={part:l,real:r==m&&s==t,elm:o,rowspan:q,colspan:p}}}})});j+=k.length})}function c(l,j){var k;k=al[j];if(k){return k[l]}}function aj(j,k){return parseInt(j.getAttribute(k)||1)}function V(j,l,k){if(j){k=parseInt(k);if(k===1){j.removeAttribute(l,1)}else{j.setAttribute(l,k,1)}}}function ai(j){return Q.hasClass(j.elm,"mceSelected")||j==ad}function ah(){var j=[];g(O.rows,function(k){g(k.cells,function(l){if(Q.hasClass(l,"mceSelected")||l==ad.elm){j.push(k);return false}})});return j}function Y(){var j=Q.createRng();j.setStartAfter(O);j.setEndAfter(O);b.setRng(j);Q.remove(O)}function am(k){var j;h.walk(k,function(l){var m;if(l.nodeType==3){g(Q.getParents(l.parentNode,null,k).reverse(),function(n){n=ac(n,false);if(!j){j=m=n}else{if(m){m.appendChild(n)}}m=n});if(m){m.innerHTML=h.isIE?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");k=ac(k,false);V(k,"rowspan",1);V(k,"colspan",1);if(j){k.appendChild(j)}else{if(!h.isIE){k.innerHTML='<br data-mce-bogus="1" />'}}return k}function aa(){var j=Q.createRng();g(Q.select("tr",O),function(k){if(k.cells.length==0){Q.remove(k)}});if(Q.select("tr",O).length==0){j.setStartAfter(O);j.setEndAfter(O);b.setRng(j);Q.remove(O);return}g(Q.select("thead,tbody,tfoot",O),function(k){if(k.rows.length==0){Q.remove(k)}});U();row=al[Math.min(al.length-1,a.y)];if(row){b.select(row[Math.min(row.length-1,a.x)].elm,true);b.collapse(true)}}function S(l,n,j,m){var o,q,r,p,k;o=al[n][l].elm.parentNode;for(r=1;r<=j;r++){o=Q.getNext(o,"tr");if(o){for(q=l;q>=0;q--){k=al[n+r][q].elm;if(k.parentNode==o){for(p=1;p<=m;p++){Q.insertAfter(am(k),k)}break}}if(q==-1){for(p=1;p<=m;p++){o.insertBefore(am(o.cells[0]),o.cells[0])}}}}}function X(){g(al,function(k,j){g(k,function(p,q){var m,n,l,o;if(ai(p)){p=p.elm;m=aj(p,"colspan");n=aj(p,"rowspan");if(m>1||n>1){V(p,"rowspan",1);V(p,"colspan",1);for(o=0;o<m-1;o++){Q.insertAfter(am(p),p)}S(q,j,n-1,m)}}})})}function ab(m,p,j){var s,t,k,l,n,q,o,v,m,u,r;if(m){pos=R(m);s=pos.x;t=pos.y;k=s+(p-1);l=t+(j-1)}else{s=a.x;t=a.y;k=W.x;l=W.y}o=c(s,t);v=c(k,l);if(o&&v&&o.part==v.part){X();U();o=c(s,t).elm;V(o,"colspan",(k-s)+1);V(o,"rowspan",(l-t)+1);for(q=t;q<=l;q++){for(n=s;n<=k;n++){m=al[q][n].elm;if(m!=o){u=h.grep(m.childNodes);g(u,function(w){o.appendChild(w)});if(u.length){u=h.grep(o.childNodes);r=0;g(u,function(w){if(w.nodeName=="BR"&&Q.getAttrib(w,"data-mce-bogus")&&r++<u.length-1){o.removeChild(w)}})}Q.remove(m)}}}aa()}}function ag(o){var r,m,p,n,l,k,q,j;g(al,function(t,s){g(t,function(u,v){if(ai(u)){u=u.elm;l=u.parentNode;k=ac(l,false);r=s;if(o){return false}}});if(o){return !r}});for(n=0;n<al[0].length;n++){m=al[r][n].elm;if(m!=p){if(!o){rowSpan=aj(m,"rowspan");if(rowSpan>1){V(m,"rowspan",rowSpan+1);continue}}else{if(r>0&&al[r-1][n]){j=al[r-1][n].elm;rowSpan=aj(j,"rowspan");if(rowSpan>1){V(j,"rowspan",rowSpan+1);continue}}}q=am(m);V(q,"colspan",m.colSpan);k.appendChild(q);p=m}}if(k.hasChildNodes()){if(!o){Q.insertAfter(k,l)}else{l.parentNode.insertBefore(k,l)}}}function ak(k){var j,l;g(al,function(n,m){g(n,function(o,p){if(ai(o)){j=p;if(k){return false}}});if(k){return !j}});g(al,function(n,m){var q=n[j].elm,p,o;if(q!=l){o=aj(q,"colspan");p=aj(q,"rowspan");if(o==1){if(!k){Q.insertAfter(am(q),q);S(j,m,p-1,o)}else{q.parentNode.insertBefore(am(q),q);S(j,m,p-1,o)}}else{V(q,"colspan",q.colSpan+1)}l=q}})}function ae(){var j=[];g(al,function(l,k){g(l,function(m,n){if(ai(m)&&h.inArray(j,n)===-1){g(al,function(o){var q=o[n].elm,p;p=aj(q,"colspan");if(p>1){V(q,"colspan",p-1)}else{Q.remove(q)}});j.push(n)}})});aa()}function af(){var j;function k(m){var n,l,o;n=Q.getNext(m,"tr");g(m.cells,function(q){var p=aj(q,"rowspan");if(p>1){V(q,"rowspan",p-1);l=R(q);S(l.x,l.y,1,1)}});l=R(m.cells[0]);g(al[l.y],function(q){var p;q=q.elm;if(q!=o){p=aj(q,"rowspan");if(p<=1){Q.remove(q)}else{V(q,"rowspan",p-1)}o=q}})}j=ah();g(j.reverse(),function(l){k(l)});aa()}function T(){var j=ah();Q.remove(j);aa();return j}function d(){var j=ah();g(j,function(k,l){j[l]=ac(k,true)});return j}function Z(l,m){var k=ah(),n=k[m?0:k.length-1],j=n.cells.length;g(al,function(o){var p;j=0;g(o,function(q,r){if(q.real){j+=q.colspan}if(q.elm.parentNode==n){p=1}});if(p){return false}});if(!m){l.reverse()}g(l,function(o){var p=o.cells.length,q;for(i=0;i<p;i++){q=o.cells[i];V(q,"colspan",1);V(q,"rowspan",1)}for(i=p;i<j;i++){o.appendChild(am(o.cells[p-1]))}for(i=j;i<p;i++){Q.remove(o.cells[i])}if(m){n.parentNode.insertBefore(o,n)}else{Q.insertAfter(o,n)}})}function R(k){var j;g(al,function(m,l){g(m,function(n,o){if(n.elm==k){j={x:o,y:l};return false}});return !j});return j}function N(j){a=R(j)}function M(){var j,k,l;k=l=0;g(al,function(n,m){g(n,function(q,r){var o,p;if(ai(q)){q=al[m][r];if(r>k){k=r}if(m>l){l=m}if(q.real){o=q.colspan-1;p=q.rowspan-1;if(o){if(r+o>k){k=r+o}}if(p){if(m+p>l){l=m+p}}}}})});return{x:k,y:l}}function P(l){var o,p,j,k,q,r,n,m;W=R(l);if(a&&W){o=Math.min(a.x,W.x);p=Math.min(a.y,W.y);j=Math.max(a.x,W.x);k=Math.max(a.y,W.y);q=j;r=k;for(y=p;y<=r;y++){l=al[y][o];if(!l.real){if(o-(l.colspan-1)<o){o-=l.colspan-1}}}for(x=o;x<=q;x++){l=al[p][x];if(!l.real){if(p-(l.rowspan-1)<p){p-=l.rowspan-1}}}for(y=p;y<=k;y++){for(x=o;x<=j;x++){l=al[y][x];if(l.real){n=l.colspan-1;m=l.rowspan-1;if(n){if(x+n>q){q=x+n}}if(m){if(y+m>r){r=y+m}}}}}Q.removeClass(Q.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=p;y<=r;y++){for(x=o;x<=q;x++){Q.addClass(al[y][x].elm,"mceSelected")}}}}h.extend(this,{deleteTable:Y,split:X,merge:ab,insertRow:ag,insertCol:ak,deleteCols:ae,deleteRows:af,cutRows:T,copyRows:d,pasteRows:Z,getPos:R,setStartCell:N,setEndCell:P})}h.create("tinymce.plugins.TablePlugin",{init:function(l,d){var m,a;function b(o){var j=l.selection,k=l.dom.getParent(o||j.getNode(),"table");if(k){return new f(k,l.dom,j)}}function c(){l.getBody().style.webkitUserSelect="";l.dom.removeClass(l.dom.select("td.mceSelected,th.mceSelected"),"mceSelected")}g([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(j){l.addButton(j[0],{title:j[1],cmd:j[2],ui:j[3]})});if(!h.isIE){l.onClick.add(function(k,j){j=j.target;if(j.nodeName==="TABLE"){k.selection.select(j)}})}l.onPreProcess.add(function(j,w){var k,v,u,s=j.dom,t;k=s.select("table",w.node);v=k.length;while(v--){u=k[v];s.setAttrib(u,"data-mce-style","");if((t=s.getAttrib(u,"width"))){s.setStyle(u,"width",t);s.setAttrib(u,"width","")}if((t=s.getAttrib(u,"height"))){s.setStyle(u,"height",t);s.setAttrib(u,"height","")}}});l.onNodeChange.add(function(j,k,n){var p;n=j.selection.getStart();p=j.dom.getParent(n,"td,th,caption");k.setActive("table",n.nodeName==="TABLE"||!!p);if(p&&p.nodeName==="CAPTION"){p=0}k.setDisabled("delete_table",!p);k.setDisabled("delete_col",!p);k.setDisabled("delete_table",!p);k.setDisabled("delete_row",!p);k.setDisabled("col_after",!p);k.setDisabled("col_before",!p);k.setDisabled("row_after",!p);k.setDisabled("row_before",!p);k.setDisabled("row_props",!p);k.setDisabled("cell_props",!p);k.setDisabled("split_cells",!p);k.setDisabled("merge_cells",!p)});l.onInit.add(function(j){var k,s,r=j.dom,u;m=j.windowManager;j.onMouseDown.add(function(o,n){if(n.button!=2){c();s=r.getParent(n.target,"td,th");k=r.getParent(s,"table")}});r.bind(j.getDoc(),"mouseover",function(n){var p,q,o=n.target;if(s&&(u||o!=s)&&(o.nodeName=="TD"||o.nodeName=="TH")){q=r.getParent(o,"table");if(q==k){if(!u){u=b(q);u.setStartCell(s);j.getBody().style.webkitUserSelect="none"}u.setEndCell(o)}p=j.selection.getSel();if(p.removeAllRanges){p.removeAllRanges()}else{p.empty()}n.preventDefault()}});j.onMouseUp.add(function(E,q){var K,I=E.selection,p,n=I.getSel(),o,H,J,F;if(s){if(u){E.getBody().style.webkitUserSelect=""}function G(z,v){var w=new h.dom.TreeWalker(z,z);do{if(z.nodeType==3&&h.trim(z.nodeValue).length!=0){if(v){K.setStart(z,0)}else{K.setEnd(z,z.nodeValue.length)}return}if(z.nodeName=="BR"){if(v){K.setStartBefore(z)}else{K.setEndBefore(z)}return}}while(z=(v?w.next():w.prev()))}p=r.select("td.mceSelected,th.mceSelected");if(p.length>0){K=r.createRng();H=p[0];F=p[p.length-1];G(H,1);o=new h.dom.TreeWalker(H,r.getParent(p[0],"table"));do{if(H.nodeName=="TD"||H.nodeName=="TH"){if(!r.hasClass(H,"mceSelected")){break}J=H}}while(H=o.next());G(J);I.setRng(K)}E.nodeChanged();s=u=k=null}});j.onKeyUp.add(function(o,n){c()});if(j&&j.plugins.contextmenu){j.plugins.contextmenu.onContextMenu.add(function(q,A,o){var n,p=j.selection,z=p.getNode()||j.getBody();if(j.dom.getParent(o,"td")||j.dom.getParent(o,"th")||j.dom.select("td.mceSelected,th.mceSelected").length){A.removeAll();if(z.nodeName=="A"&&!j.dom.getAttrib(z,"name")){A.add({title:"advanced.link_desc",icon:"link",cmd:j.plugins.advlink?"mceAdvLink":"mceLink",ui:true});A.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});A.addSeparator()}if(z.nodeName=="IMG"&&z.className.indexOf("mceItem")==-1){A.add({title:"advanced.image_desc",icon:"image",cmd:j.plugins.advimage?"mceAdvImage":"mceImage",ui:true});A.addSeparator()}A.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});A.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});A.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});A.addSeparator();n=A.addMenu({title:"table.cell"});n.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});n.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});n.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});n=A.addMenu({title:"table.row"});n.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});n.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});n.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});n.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});n.addSeparator();n.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});n.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});n.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!a);n.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!a);n=A.addMenu({title:"table.col"});n.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});n.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});n.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{A.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(!h.isIE){function t(){var n;for(n=j.getBody().lastChild;n&&n.nodeType==3&&!n.nodeValue.length;n=n.previousSibling){}if(n&&n.nodeName=="TABLE"){j.dom.add(j.getBody(),"p",null,'<br mce_bogus="1" />')}}if(h.isGecko){j.onKeyDown.add(function(q,o){var w,p,n=q.dom;if(o.keyCode==37||o.keyCode==38){w=q.selection.getRng();p=n.getParent(w.startContainer,"table");if(p&&q.getBody().firstChild==p){if(e(w,p)){w=n.createRng();w.setStartBefore(p);w.setEndBefore(p);q.selection.setRng(w);o.preventDefault()}}}})}j.onKeyUp.add(t);j.onSetContent.add(t);j.onVisualAid.add(t);j.onPreProcess.add(function(p,n){var o=n.node.lastChild;if(o&&o.childNodes.length==1&&o.firstChild.nodeName=="BR"){p.dom.remove(o)}});t()}});g({mceTableSplitCells:function(j){j.split()},mceTableMergeCells:function(j){var q,p,k;k=l.dom.getParent(l.selection.getNode(),"th,td");if(k){q=k.rowSpan;p=k.colSpan}if(!l.dom.select("td.mceSelected,th.mceSelected").length){m.open({url:d+"/merge_cells.htm",width:240+parseInt(l.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(l.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:q,cols:p,onaction:function(n){j.merge(k,n.cols,n.rows)},plugin_url:d})}else{j.merge()}},mceTableInsertRowBefore:function(j){j.insertRow(true)},mceTableInsertRowAfter:function(j){j.insertRow()},mceTableInsertColBefore:function(j){j.insertCol(true)},mceTableInsertColAfter:function(j){j.insertCol()},mceTableDeleteCol:function(j){j.deleteCols()},mceTableDeleteRow:function(j){j.deleteRows()},mceTableCutRow:function(j){a=j.cutRows()},mceTableCopyRow:function(j){a=j.copyRows()},mceTablePasteRowBefore:function(j){j.pasteRows(a,true)},mceTablePasteRowAfter:function(j){j.pasteRows(a)},mceTableDelete:function(j){j.deleteTable()}},function(j,k){l.addCommand(k,function(){var o=b();if(o){j(o);l.execCommand("mceRepaint");c()}})});g({mceInsertTable:function(j){m.open({url:d+"/table.htm",width:400+parseInt(l.getLang("table.table_delta_width",0)),height:320+parseInt(l.getLang("table.table_delta_height",0)),inline:1},{plugin_url:d,action:j?j.action:0})},mceTableRowProps:function(){m.open({url:d+"/row.htm",width:400+parseInt(l.getLang("table.rowprops_delta_width",0)),height:295+parseInt(l.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:d})},mceTableCellProps:function(){m.open({url:d+"/cell.htm",width:400+parseInt(l.getLang("table.cellprops_delta_width",0)),height:295+parseInt(l.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:d})}},function(j,k){l.addCommand(k,function(q,p){j(p)})})}});h.PluginManager.add("table",h.plugins.TablePlugin)})(tinymce);